<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Summer Training 2025 Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        /* ... (your sidebar and map CSS here, unchanged from previous example) ... */
        /* You can keep all CSS from previous working examples */
    </style>
</head>
<body>
    <div id="sidebar" class="sidebar-open">
        <h2>Summer Training 2025</h2>
        <div id="location-list"></div>
    </div>
    <button id="sidebar-toggle-btn" title="Hide/show key">&laquo;</button>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
    // Inline addresses array -- put this in addresses.js if you want, but see notes below
    const addresses = [
        {
            name: "FURY (150 - 200)",
            poc: "Jay Merrifield",
            phone: "801-336-6924",
            address: "15440 Laguna Canyon Rd. Suite 210. Irvine, CA. 92618",
            coords: [33.6644, -117.7576],
            date: "June 26 - 27"
        },
        {
            name: "BAN, UNITED, & FORGE (65-75)",
            poc: "Grant Misbach",
            phone: "(801) 643-9206",
            address: "10532 Acacia St. Rancho Cucomongo, Ca. 91730",
            coords: [34.0921, -117.5743],
            date: "June 30 - July 1"
        },
        {
            name: "MOMENTVS (70-80)",
            poc: "Cole Sexton & Christian Harrison",
            phone: "320-339-1204",
            address: "10532 Acacia St. Rancho Cucomongo, Ca. 91730",
            coords: [34.0921, -117.5737], // offset for duplicate address
            date: "June 23 - 24"
        },
        // ...rest of your addresses...
    ];

    function parseDateRange(dateStr) {
        const months = { "June": 5, "July": 6, "August": 7 };
        const parts = dateStr.split("-");
        if (parts.length === 2) {
            const [startStr, endStr] = parts;
            const startMatch = startStr.trim().match(/([A-Za-z]+)\s+(\d+)/);
            if (!startMatch) return null;
            const startMonth = startMatch[1];
            const startDay = parseInt(startMatch[2], 10);
            const endMatch = endStr.trim().match(/([A-Za-z]+)?\s*(\d+)/);
            let endMonth = startMonth;
            let endDay;
            if (endMatch) {
                if (endMatch[1]) endMonth = endMatch[1];
                endDay = parseInt(endMatch[2], 10);
            }
            return [
                { month: startMonth, monthNum: months[startMonth], day: startDay },
                { month: endMonth, monthNum: months[endMonth], day: endDay }
            ];
        }
        return null;
    }

    function groupAndSortEvents(events) {
        const eventsWithKeys = events.map(event => {
            const range = parseDateRange(event.date);
            let sortKey = 0;
            if (range) sortKey = (range[0].monthNum || 0) * 100 + range[0].day;
            return { ...event, sortKey, startMonth: range ? range[0].month : "Unknown" };
        });
        eventsWithKeys.sort((a, b) => a.sortKey - b.sortKey);

        const grouped = {};
        eventsWithKeys.forEach(event => {
            if (!grouped[event.startMonth]) grouped[event.startMonth] = [];
            grouped[event.startMonth].push(event);
        });
        return grouped;
    }

    const blueIcon = new L.Icon({
        iconUrl: 'https://unpkg.com/leaflet/dist/images/marker-icon.png',
        iconRetinaUrl: 'https://unpkg.com/leaflet/dist/images/marker-icon-2x.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowUrl: 'https://unpkg.com/leaflet/dist/images/marker-shadow.png',
        shadowSize: [41, 41]
    });
    const redIcon = new L.Icon({
        iconUrl: 'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-red.png',
        iconRetinaUrl: 'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-red.png',
        iconSize: [36, 55],
        iconAnchor: [18, 55],
        popupAnchor: [1, -44],
        shadowUrl: 'https://unpkg.com/leaflet/dist/images/marker-shadow.png',
        shadowSize: [55, 55]
    });

    let markerRefs = [];
    let sidebarEventDivs = [];

    function getOrderedEvents() {
        const grouped = groupAndSortEvents(addresses);
        let ordered = [];
        for (const month of Object.keys(grouped)) {
            for (const event of grouped[month]) {
                ordered.push(event);
            }
        }
        return ordered;
    }

    function expandAndHighlight(idx) {
        sidebarEventDivs.forEach((div, i) => {
            if (i === idx) {
                div.classList.add('expanded');
                div.scrollIntoView({ behavior: "smooth", block: "center" });
            } else {
                div.classList.remove('expanded');
            }
        });
        markerRefs.forEach((marker, i) => {
            if (i === idx) {
                marker.setIcon(redIcon);
                marker.setZIndexOffset(1000);
                marker.openPopup();
            } else {
                marker.setIcon(blueIcon);
                marker.setZIndexOffset(0);
                marker.closePopup();
            }
        });
    }

    function renderSidebar() {
        const colors = { "June": "#f9f9ef", "July": "#eef7fa", "August": "#f7eef9", "Unknown": "#f5f5f5" };
        const grouped = groupAndSortEvents(addresses);
        const container = document.getElementById('location-list');
        container.innerHTML = '';
        sidebarEventDivs = [];
        let idx = 0;
        for (const month of Object.keys(grouped)) {
            const events = grouped[month];
            const monthDiv = document.createElement('div');
            monthDiv.className = 'month-group';
            monthDiv.style.backgroundColor = colors[month] || "#f8f8f8";

            const monthLabel = document.createElement('div');
            monthLabel.className = 'month-label';
            monthLabel.textContent = month;
            monthDiv.appendChild(monthLabel);

            events.forEach((event) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'event-item';
                itemDiv.setAttribute('data-index', idx);

                const headerDiv = document.createElement('div');
                headerDiv.className = 'event-header';
                headerDiv.innerHTML = `<span class="event-name">${event.name}</span>
                                       <span class="event-date">${event.date}</span>`;

                headerDiv.addEventListener('click', function() {
                    expandAndHighlight(idx);
                });

                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'event-details';
                detailsDiv.innerHTML = `
                    <div><strong>POC:</strong> ${event.poc}</div>
                    <div><strong>Phone:</strong> ${event.phone}</div>
                    <div><strong>Address:</strong> ${event.address}</div>
                `;

                itemDiv.appendChild(headerDiv);
                itemDiv.appendChild(detailsDiv);
                monthDiv.appendChild(itemDiv);
                sidebarEventDivs.push(itemDiv);
                idx++;
            });
            container.appendChild(monthDiv);
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        renderSidebar();

        // Initialize map
        window.map = L.map('map').setView([36.7783, -119.4179], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(window.map);

        // Markers (in order)
        let orderedEvents = getOrderedEvents();
        markerRefs = [];
        for (let i = 0; i < orderedEvents.length; i++) {
            const loc = orderedEvents[i];
            const marker = L.marker(loc.coords, { icon: blueIcon })
                .addTo(window.map)
                .bindPopup(`<strong>${loc.name}</strong><br>${loc.address}<br>${loc.date}`);
            markerRefs.push(marker);

            marker.on('click', function() {
                expandAndHighlight(i);
            });
        }

        // Sidebar toggle
        const sidebarEl = document.getElementById('sidebar');
        const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
        let sidebarOpen = true;
        function updateSidebarToggleArrow() {
            sidebarToggleBtn.innerHTML = sidebarOpen ? "&laquo;" : "&raquo;";
            sidebarToggleBtn.title = sidebarOpen ? "Hide key" : "Show key";
        }
        sidebarToggleBtn.addEventListener('click', function() {
            sidebarOpen = !sidebarOpen;
            if (sidebarOpen) {
                sidebarEl.classList.remove('sidebar-closed');
            } else {
                sidebarEl.classList.add('sidebar-closed');
            }
            updateSidebarToggleArrow();
        });
        updateSidebarToggleArrow();
    });
    </script>
</body>
</html>
